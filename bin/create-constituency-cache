#!/usr/bin/php -q
<?
// create-constituency-cache
// To speed up the league table
//
// Copyright (c) 2005 UK Citizens Online Democracy. All rights reserved.
// Email: matthew@mysociety.org. WWW: http://www.mysociety.org
//
// $Id: create-constituency-cache,v 1.1 2005-11-18 15:30:23 ycml Exp $

require_once '../phplib/ycml.php';
require_once '../../phplib/mapit.php';

$q = db_query("SELECT DISTINCT(constituency) FROM constituent WHERE constituency IS NOT NULL");
$ids = array();
while ($r = db_fetch_array($q)) {
    if ($r['constituency'])
        $ids[] = $r['constituency'];
}

$areas_info = mapit_get_voting_areas_info($ids);

db_query('DELETE FROM constituency_cache');
foreach ($areas_info as $area_info) {
	print $area_info['area_id'] . ' ' . $area_info['name'] . "\n";
	db_query("INSERT INTO constituency_cache VALUES (?,?)", array($area_info['area_id'], $area_info['name']) );
}
db_commit();
